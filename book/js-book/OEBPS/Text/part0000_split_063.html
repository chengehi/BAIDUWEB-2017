<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>未知</title>
  <link href="../Styles/Style.css" rel="stylesheet" type="text/css" />
  <link href="../Styles/custom.css" rel="stylesheet" type="text/css" />
</head>

<body class="calibre">
  <h2 class="calibre9" id="nav_point_53">8.3　navigator对象</h2>

  <p class="calibre2">最早由Netscape Navigator 2.0引入的<code class="calibre15">navigator</code>对象，现在已经成为识别客户端浏览器的事实标准。虽然其他浏览器也通过其他方式提供了相同或相似的信息（例如，IE中的<code class="calibre15">window.clientInformation</code>和Opera中的<code class="calibre15">window.opera</code>），但<code class="calibre15">navigator</code>对象却是所有支持JavaScript的浏览器所共有的。与其他BOM对象的情况一样，每个浏览器中的<code class="calibre15">navigator</code>对象也都有一套自己的属性。下表列出了存在于所有浏览器中的属性和方法，以及支持它们的浏览器版本。</p>

  <table class="table">
    <tbody class="calibre23">
      <tr class="calibre24">
        <th class="calibre25" width="22%">属性或方法</th>

        <th class="calibre25" width="34%">说　　明</th>

        <th class="calibre25" width="10%">IE</th>

        <th class="calibre25" width="12%">Firefox</th>

        <th class="calibre25" width="12%">Safari/<br class="calibre41" />
        Chrome</th>

        <th class="calibre25" width="10%">Opera</th>
      </tr>

      <tr class="calibre26">
        <td class="calibre27"><code class="calibre31">appCodeName</code></td>

        <td class="calibre27">浏览器的名称。通常都是<code class="calibre31">Mozilla</code>，即使在非Mozilla浏览器中也是如此</td>

        <td class="calibre27">3.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">7.0+</td>
      </tr>

      <tr class="calibre24">
        <td class="calibre27"><code class="calibre31">appMinorVersion</code></td>

        <td class="calibre27">次版本信息</td>

        <td class="calibre27">4.0+</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>

        <td class="calibre27">9.5+</td>
      </tr>

      <tr class="calibre26">
        <td class="calibre27"><code class="calibre31">appName</code></td>

        <td class="calibre27">完整的浏览器名称</td>

        <td class="calibre27">3.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">7.0+</td>
      </tr>

      <tr class="calibre24">
        <td class="calibre27"><code class="calibre31">appVersion</code></td>

        <td class="calibre27">浏览器的版本。一般不与实际的浏览器版本对应</td>

        <td class="calibre27">3.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">7.0+</td>
      </tr>

      <tr class="calibre26">
        <td class="calibre27"><code class="calibre31">buildID</code></td>

        <td class="calibre27">浏览器编译版本</td>

        <td class="calibre27">－</td>

        <td class="calibre27">2.0+</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>
      </tr>

      <tr class="calibre24">
        <td class="calibre27"><code class="calibre31">cookieEnabled</code></td>

        <td class="calibre27">表示cookie是否启用</td>

        <td class="calibre27">4.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">7.0+</td>
      </tr>

      <tr class="calibre26">
        <td class="calibre27"><code class="calibre31">cpuClass</code></td>

        <td class="calibre27">客户端计算机中使用的CPU类型（x86、68K、Alpha、PPC或Other）</td>

        <td class="calibre27">4.0+</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>
      </tr>

      <tr class="calibre24">
        <td class="calibre27"><code class="calibre31">javaEnabled()</code></td>

        <td class="calibre27">表示当前浏览器中是否启用了Java</td>

        <td class="calibre27">4.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">7.0+</td>
      </tr>

      <tr class="calibre26">
        <td class="calibre27"><code class="calibre31">language</code></td>

        <td class="calibre27">浏览器的主语言</td>

        <td class="calibre27">－</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">7.0+</td>
      </tr>

      <tr class="calibre24">
        <td class="calibre27"><code class="calibre31">mimeTypes</code></td>

        <td class="calibre27">在浏览器中注册的MIME类型数组</td>

        <td class="calibre27">4.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">7.0+</td>
      </tr>

      <tr class="calibre26">
        <td class="calibre27"><code class="calibre31">onLine</code></td>

        <td class="calibre27">表示浏览器是否连接到了因特网</td>

        <td class="calibre27">4.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">－</td>

        <td class="calibre27">9.5+</td>
      </tr>

      <tr class="calibre24">
        <td class="calibre27"><code class="calibre31">opsProfile</code></td>

        <td class="calibre27">似乎早就不用了。查不到相关文档</td>

        <td class="calibre27">4.0+</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>
      </tr>

      <tr class="calibre26">
        <td class="calibre27"><code class="calibre31">oscpu</code></td>

        <td class="calibre27">客户端计算机的操作系统或使用的CPU</td>

        <td class="calibre27">－</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>
      </tr>

      <tr class="calibre24">
        <td class="calibre27"><code class="calibre31">Platform</code></td>

        <td class="calibre27">浏览器所在的系统平台</td>

        <td class="calibre27">4.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">7.0+</td>
      </tr>

      <tr class="calibre26">
        <td class="calibre27"><code class="calibre31">plugins</code></td>

        <td class="calibre27">浏览器中安装的插件信息的数组</td>

        <td class="calibre27">4.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">7.0+</td>
      </tr>

      <tr class="calibre24">
        <td class="calibre27"><code class="calibre31">preference()</code></td>

        <td class="calibre27">设置用户的首选项</td>

        <td class="calibre27">－</td>

        <td class="calibre27">1.5+</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>
      </tr>

      <tr class="calibre26">
        <td class="calibre27"><code class="calibre31">product</code></td>

        <td class="calibre27">产品名称（如 Gecko）</td>

        <td class="calibre27">－</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">－</td>
      </tr>

      <tr class="calibre24">
        <td class="calibre27"><code class="calibre31">productSub</code></td>

        <td class="calibre27">关于产品的次要信息（如<code class="calibre31">Gecko</code>的版本）</td>

        <td class="calibre27">－</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">－</td>
      </tr>

      <tr class="calibre26">
        <td class="calibre27"><code class="calibre31">register-<br class="calibre41" />
        ContentHandler()</code></td>

        <td class="calibre27">针对特定的MIME类型将一个站点注册为处理程序</td>

        <td class="calibre27">－</td>

        <td class="calibre27">2.0+</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>
      </tr>

      <tr class="calibre24">
        <td class="calibre27"><code class="calibre31">register-<br class="calibre41" />
        ProtocolHandler()</code></td>

        <td class="calibre27">针对特定的协议将一个站点注册为处理程序</td>

        <td class="calibre27">－</td>

        <td class="calibre27">2.0</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>
      </tr>

      <tr class="calibre26">
        <td class="calibre27"><code class="calibre31">securityPolicy</code></td>

        <td class="calibre27">已经废弃。安全策略的名称。为了与Netscape Navigator 4向后兼容而保留下来</td>

        <td class="calibre27">－</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>
      </tr>

      <tr class="calibre24">
        <td class="calibre27"><code class="calibre31">systemLanguage</code></td>

        <td class="calibre27">操作系统的语言</td>

        <td class="calibre27">4.0+</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>
      </tr>

      <tr class="calibre26">
        <td class="calibre27"><code class="calibre31">taintEnabled()</code></td>

        <td class="calibre27">已经废弃。表示是否允许变量被修改（taint）。为了与Netscape Navigator 3向后兼容而保留下来</td>

        <td class="calibre27">4.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">－</td>

        <td class="calibre27">7.0+</td>
      </tr>

      <tr class="calibre24">
        <td class="calibre27"><code class="calibre31">userAgent</code></td>

        <td class="calibre27">浏览器的用户代理字符串</td>

        <td class="calibre27">3.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">7.0+</td>
      </tr>

      <tr class="calibre26">
        <td class="calibre27"><code class="calibre31">userLanguage</code></td>

        <td class="calibre27">操作系统的默认语言</td>

        <td class="calibre27">4.0+</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>

        <td class="calibre27">7.0+</td>
      </tr>

      <tr class="calibre24">
        <td class="calibre27"><code class="calibre31">userProfile</code></td>

        <td class="calibre27">借以访问用户个人信息的对象</td>

        <td class="calibre27">4.0+</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>

        <td class="calibre27">－</td>
      </tr>

      <tr class="calibre26">
        <td class="calibre27"><code class="calibre31">vendor</code></td>

        <td class="calibre27">浏览器的品牌</td>

        <td class="calibre27">－</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">－</td>
      </tr>

      <tr class="calibre24">
        <td class="calibre27"><code class="calibre31">vendorSub</code></td>

        <td class="calibre27">有关供应商的次要信息</td>

        <td class="calibre27">－</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">1.0+</td>

        <td class="calibre27">－</td>
      </tr>
    </tbody>
  </table>

  <p class="calibre2">表中的这些<code class="calibre15">navigator</code>对象的属性通常用于检测显示网页的浏览器类型（第9章会详细讨论）。</p>

  <h3 class="calibre22" id="sigil_toc_id_109"><strong class="calibre10">8.3.1　检测插件</strong></h3>

  <p class="calibre2">检测浏览器中是否安装了特定的插件是一种最常见的检测例程。对于非IE浏览器，可以使用<code class="calibre15">plugins</code>数组来达到这个目的。该数组中的每一项都包含下列属性。</p>

  <ul class="calibre16">
    <li class="calibre12">
      <p class="calibre2"><code class="calibre15">name</code>：插件的名字。</p>
    </li>

    <li class="calibre12">
      <p class="calibre2"><code class="calibre15">description</code>：插件的描述。</p>
    </li>

    <li class="calibre12">
      <p class="calibre2"><code class="calibre15">filename</code>：插件的文件名。</p>
    </li>

    <li class="calibre12">
      <p class="calibre2"><code class="calibre15">length</code>：插件所处理的MIME类型数量。</p>
    </li>
  </ul>

  <p class="calibre2">一般来说，<code class="calibre15">name</code>属性中会包含检测插件必需的所有信息，但有时候也不完全如此。在检测插件时，需要像下面这样循环迭代每个插件并将插件的<code class="calibre15">name</code>与给定的名字进行比较。</p>

  <p class="p-img"><img alt="" class="calibre17" src="../Images/00003.gif" /></p>
  <pre class="calibre18"><code class="calibre15">//检测插件（在IE中无效）
function hasPlugin(name){
    name = name.toLowerCase();
    for (var i=0; i &lt; navigator.plugins.length; i++){
        if (navigator. plugins [i].name.toLowerCase().indexOf(name) &gt; -1){
            return true;
        }
    }

    return false;
}

//检测Flash
alert(hasPlugin("Flash"));

//检测QuickTime
alert(hasPlugin("QuickTime"));
</code></pre>

  <p class="calibre8"><i class="calibre7">PluginDetectionExample01.htm</i></p>

  <p class="calibre2">这个<code class="calibre15">hasPlugin()</code>函数接受一个参数：要检测的插件名。第一步是将传入的名称转换为小写形式，以便于比较。然后，迭代<code class="calibre15">plugins</code>数组，通过<code class="calibre15">indexOf()</code>检测每个<code class="calibre15">name</code>属性，以确定传入的名称是否出现在字符串的某个地方。比较的字符串都使用小写形式可以避免因大小写不一致导致的错误。而传入的参数应该尽可能具体，以避免混淆。应该说，像<code class="calibre15">Flash</code>和<code class="calibre15">QuickTime</code>这样的字符串就比较具体了，不容易导致混淆。在Firefox、Safari、Opera和Chrome中可以使用这种方法来检测插件。</p>

  <blockquote class="calibre14">
    <p class="calibre2"><img alt="" class="calibre17" src="../Images/00002.gif" /> 每个插件对象本身也是一个<code class="calibre15">MimeType</code>对象的数组，这些对象可以通过方括号语法来访问。每个<code class="calibre15">MimeType</code>对象有4个属性：包含MIME类型描述的<code class="calibre15">description</code>、回指插件对象的<code class="calibre15">enabledPlugin</code>、表示与MIME类型对应的文件扩展名的字符串<code class="calibre15">suffixes</code>（以逗号分隔）和表示完整MIME类型字符串的<code class="calibre15">type</code>。</p>
  </blockquote>

  <p class="calibre2">检测IE中的插件比较麻烦，因为IE不支持Netscape式的插件。在IE 中检测插件的唯一方式就是使用专有的<code class="calibre15">ActiveXObject</code>类型，并尝试创建一个特定插件的实例。IE是以COM对象的方式实现插件的，而COM对象使用唯一标识符来标识。因此，要想检查特定的插件，就必须知道其COM标识符。例如，Flash的标识符是<code class="calibre15">ShockwaveFlash.ShockwaveFlash</code>。知道唯一标识符之后，就可以编写类似下面的函数来检测IE中是否安装相应插件了。</p>

  <p class="p-img"><img alt="" class="calibre17" src="../Images/00003.gif" /></p>
  <pre class="calibre18"><code class="calibre15">//检测IE中的插件
function hasIEPlugin(name){
    try {
        new ActiveXObject(name);
        return true;
    } catch (ex){
        return false;
    }
}

//检测Flash
alert(hasIEPlugin("ShockwaveFlash.ShockwaveFlash"));

//检测QuickTime
alert(hasIEPlugin("QuickTime.QuickTime"));
</code></pre>

  <p class="calibre8"><i class="calibre7">PluginDetectionExample02.htm</i></p>

  <p class="calibre2">在这个例子中，函数<code class="calibre15">hasIEPlugin()</code>只接收一个COM标识符作为参数。在函数内部，首先会尝试创建一个COM对象的实例。之所以要在<code class="calibre15">try-catch</code>语句中进行实例化，是因为创建未知COM对象会导致抛出错误。这样，如果实例化成功，则函数返回<code class="calibre15">true</code>；否则，如果抛出了错误，则执行<code class="calibre15">catch</code>块，结果就会返回<code class="calibre15">false</code>。例子最后检测IE中是否安装了Flash和QuickTime插件。</p>

  <p class="calibre2">鉴于检测这两种插件的方法差别太大，因此典型的做法是针对每个插件分别创建检测函数，而不是使用前面介绍的通用检测方法。来看下面的例子。</p>
  <pre class="calibre18"><code class="calibre15">//检测所有浏览器中的Flash
function hasFlash(){
    var result = hasPlugin("Flash");
    if (!result){
        result = hasIEPlugin("ShockwaveFlash.ShockwaveFlash");
    }
    return result;
}

//检测所有浏览器中的QuickTime
function hasQuickTime(){
    var result = hasPlugin("QuickTime");
    if (!result){
        result = hasIEPlugin("QuickTime.QuickTime");
    }
    return result;
}

//检测Flash
alert(hasFlash());

//检测QuickTime
alert(hasQuickTime());
</code></pre>

  <p class="calibre8"><i class="calibre7">PluginDetectionExample03.htm</i></p>

  <p class="calibre2">上面代码中定义了两个函数：<code class="calibre15">hasFlash()</code>和<code class="calibre15">hasQuickTime()</code>。每个函数都是先尝试使用不针对IE的插件检测方法。如果返回了<code class="calibre15">false</code>（在IE中会这样），那么再使用针对IE的插件检测方法。如果IE的插件检测方法再返回<code class="calibre15">false</code>，则整个方法也将返回<code class="calibre15">false</code>。只要任何一次检测返回<code class="calibre15">true</code>，整个方法都会返回<code class="calibre15">true</code>。</p>

  <blockquote class="calibre14">
    <p class="calibre2"><img alt="" class="calibre17" src="../Images/00002.gif" /> <code class="calibre15">plugins</code>集合有一个名叫<code class="calibre15">refresh()</code>的方法，用于刷新<code class="calibre15">plugins</code>以反映最新安装的插件。这个方法接收一个参数：表示是否应该重新加载页面的一个布尔值。如果将这个值设置为<code class="calibre15">true</code>，则会重新加载包含插件的所有页面；否则，只更新<code class="calibre15">plugins</code>集合，不重新加载页面。</p>
  </blockquote>

  <h3 class="calibre22" id="sigil_toc_id_110"><strong class="calibre10">8.3.2　注册处理程序</strong></h3>

  <p class="calibre2">Firefox 2为<code class="calibre15">navigator</code>对象新增了<code class="calibre15">registerContentHandler()</code>和<code class="calibre15">registerProtocolHandler()</code>方法（这两个方法是在HTML5中定义的，相关内容将在第22章讨论）。这两个方法可以让一个站点指明它可以处理特定类型的信息。随着RSS阅读器和在线电子邮件程序的兴起，注册处理程序就为像使用桌面应用程序一样默认使用这些在线应用程序提供了一种方式。</p>

  <p class="calibre2">其中，<code class="calibre15">registerContentHandler()</code>方法接收三个参数：要处理的MIME类型、可以处理该MIME类型的页面的URL以及应用程序的名称。举个例子，要将一个站点注册为处理RSS源的处理程序，可以使用如下代码。</p>
  <pre class="calibre18"><code class="calibre15">navigator.registerContentHandler("application/rss+xml",
    "http://www.somereader.com?feed=%s", "Some Reader");
</code></pre>

  <p class="calibre2">第一个参数是RSS源的MIME类型。第二个参数是应该接收RSS源URL的URL，其中的<code class="calibre15">%s</code>表示RSS源URL，由浏览器自动插入。当下一次请求RSS源时，浏览器就会打开指定的URL，而相应的Web应用程序将以适当方式来处理该请求。</p>

  <blockquote class="calibre14">
    <p class="calibre2"><img alt="" class="calibre17" src="../Images/00002.gif" /> Firefox 4及之前版本只允许在<code class="calibre15">registerContentHandler()</code>方法中使用三个MIME类型：<code class="calibre15">application/rss+xml</code>、<code class="calibre15">application/atom+xml</code>和<code class="calibre15">application/vnd.mozilla.maybe. feed</code>。这三个MIME类型的作用都一样，即为RSS或ATOM新闻源（feed）注册处理程序。</p>
  </blockquote>

  <p class="calibre2">类似的调用方式也适用于<code class="calibre15">registerProtocolHandler()</code>方法，它也接收三个参数：要处理的协议（例如，<code class="calibre15">mailto</code>或<code class="calibre15">ftp</code>）、处理该协议的页面的URL和应用程序的名称。例如，要想将一个应用程序注册为默认的邮件客户端，可以使用如下代码。</p>
  <pre class="calibre18"><code class="calibre15">navigator.registerProtocolHandler("mailto",
    "http://www.somemailclient.com?cmd=%s", "Some Mail Client");
</code></pre>

  <p class="calibre2">这个例子注册了一个<code class="calibre15">mailto</code>协议的处理程序，该程序指向一个基于Web的电子邮件客户端。同样，第二个参数仍然是处理相应请求的URL，而<code class="calibre15">%s</code>则表示原始的请求。</p>

  <blockquote class="calibre14">
    <p class="calibre2"><img alt="" class="calibre17" src="../Images/00002.gif" /> Firefox 2虽然实现了<code class="calibre15">registerProtocolHandler()</code>，但该方法还不能用。Firefox 3完整实现这个方法。</p>
  </blockquote>
</body>
</html>
